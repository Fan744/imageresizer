let cropFile,cropCanvas=document.getElementById('cropCanvas'),cropCtx=cropCanvas?.getContext('2d');document.getElementById('cropInput')?.addEventListener('change',e=>{cropFile=e.target.files[0];let img=new Image();img.onload=function(){cropCanvas.width=img.width;cropCanvas.height=img.height;cropCtx.drawImage(img,0,0)};img.src=URL.createObjectURL(cropFile)});function cropImage(){let canvas=cropCanvas,ctx=cropCtx;let size=Math.min(canvas.width,canvas.height);let imgData=ctx.getImageData(0,0,size,size);canvas.width=size;canvas.height=size;ctx.putImageData(imgData,0,0);let link=document.getElementById('downloadCrop');link.href=canvas.toDataURL('image/png');link.style.display='block'}let convertFile;document.getElementById('convertInput')?.addEventListener('change',e=>convertFile=e.target.files[0]);function convertImage(){if(!convertFile)return alert('Upload image first!');let format=document.getElementById('formatSelect').value;let img=new Image();img.onload=function(){let canvas=document.getElementById('convertCanvas');let ctx=canvas.getContext('2d');canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);let link=document.getElementById('downloadConvert');link.href=canvas.toDataURL(format);link.download='converted'+(format==='image/png'?'.png':format==='image/jpeg'?'.jpg':'.webp');link.style.display='block';link.innerText='Download Converted Image'};img.src=URL.createObjectURL(convertFile)}async function convertToPDF(){const{jsPDF}=window.jspdf;let files=document.getElementById('pdfInput').files;if(!files.length)return alert('Select images first!');let pdf=new jsPDF();for(let i=0;i<files.length;i++){let img=new Image();img.src=URL.createObjectURL(files[i]);await new Promise(resolve=>{img.onload=function(){let width=pdf.internal.pageSize.getWidth();let height=(img.height*width)/img.width;if(i>0)pdf.addPage();pdf.addImage(img,'JPEG',0,0,width,height);resolve()}})}pdf.save('converted.pdf')}